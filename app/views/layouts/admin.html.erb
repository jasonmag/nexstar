<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <title>
      <% if content_for?(:title) %>
        <%= yield :title %> | Admin | <%= Rails.application.class.module_parent_name %>
      <% else %>
        Admin | <%= Rails.application.class.module_parent_name %>
      <% end %>
    </title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- Early theme (prevents flash of wrong theme) -->
    <script>
      (function () {
        try {
          const ls = localStorage.getItem('theme');
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const chosen = ls || (prefersDark ? 'dark' : 'light');
          if (chosen === 'dark') document.documentElement.classList.add('dark');
          else document.documentElement.classList.remove('dark');
        } catch (_) {}
      })();
    </script>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-background text-text antialiased font-sans min-h-screen">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <%= render "layouts/admin_sidebar" %>

      <!-- Main Content -->
      <main class="flex-1 p-6 bg-white dark:bg-gray-900 rounded-l-3xl shadow-xl">
        <header class="flex justify-between items-center mb-6 border-b border-gray-200 dark:border-gray-700 pb-4 gap-4">
          <h1 class="text-2xl font-semibold">
            <%= content_for?(:title) ? yield(:title) : "Admin" %>
          </h1>

          <div class="flex items-center gap-4">
            <%= render "shared/dark_mode_toggle" %>

            <% if user_signed_in? %>
              <div class="text-sm bg-gray-100 dark:bg-gray-800 rounded px-3 py-1 flex items-center shadow">
                <span class="mr-2">
                  Logged in as <strong><%= current_user.email %></strong>
                </span>
                <%= link_to "Logout",
                            destroy_user_session_path,
                            method: :delete,
                            data: { turbo_method: :delete },
                            class: "ml-2 text-red-500 hover:underline font-semibold" %>
              </div>
            <% end %>
          </div>
        </header>

        <%= render "shared/flash" %>

        <div>
          <%= yield %>
        </div>
      </main>
    </div>
  </body>
</html>
